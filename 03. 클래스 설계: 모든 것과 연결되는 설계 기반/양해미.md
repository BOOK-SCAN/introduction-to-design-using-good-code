# **📌 Content**

## **📌 클래스 단위로 잘 동작하도록 설계하고 성숙하게 설계하기**

**잘 만들어진 클래스**

- 인스턴스 변수
- 인스턴스 변수에 잘못된 값이 할당되지 않게 막고, 정상적으로 조작하는 메서드

| GoodClass |
| --- |
| field: type |
| method(): type |

🔺반드시 메서드와 인스턴스 변수를 함께 사용해야 한다.

**잘못된 값이 유입되지 못하게 유효성 검사를 생성자 내부에 정의한다. (가드 (guard))**

```java
class Money{
//생략
Money(int amount, Currency currency){
	if (amount < 0) {
		throw new IllegalArgumentException("금액은 0이상의 값을 지정해 주세요.");
	}
	if (currency == null){
		throw new IllegalArgumentException("통화 단위를 지정해 주세요.");
	}
	
	this.amount = amount;
	this.currency = currency;
```

**계산 로직도 데이터를 가진 쪽에 구현하기**

‘데이터’와 ‘데이터를 조작학는 로직’이 분리되어있는 구조를 ‘응집도가 낮은 구조’라고 한다.

응집도가 낮은 구조는 문제를 야기시킨다.

**불변 변수로 만들어서 예상 못한 동작 막기**

final 쓰기~

```java
class Money{
	**final** int amount;
	**final** Currency currency;
	
	Money(int amount, Currency currency){
	//생략
	this.amount = amount;
	this.currency = currency;
	}
}
```

근데 인스턴스 값을 변경하고 싶다면?

→ 변경된 값을 가진 새로운 인스턴스를 만들어서 사용하면 된다!

그리고 매서드 구조가 안전해지도록 매개변수에 final을 붙이자.

```java
class Money{
//생략
	Money add (final int other) {
		int added = amount + other;
		return new Money(added, currency_;
	}
}
```

그리고 엉뚱한 값을 받지 않도록 매개변수의 자료형을 int → Money로 바꿔준다.

```java
class Money{
//생략
	Money add (final Money other) {
		int added = amount + other;
		return new Money(added, currency_;
	}
}
```

**추가로 의미없는 메서드 추가하지 않기**

## **📌 프로그램 구조의 문제 해결에 도움을 주는 디자인 패턴**

**디자인 패턴**

: 응집도가 높은 구조로 만들거나, 잘못된 상태로부터 프로그램을 방어하는 등 프로그램의 구조를 개선하는 설계 방법.

| 디자인 패턴 | 효과 |
| --- | --- |
| 완전 생성자 | 잘못된 상태로부터 보호함. |
| 값 객체 | 특정한 값과 관련된 로직의 응집도를 높임. |
| 전략
(strategy) | 조건 분기를 줄이고, 로직을 단순화함. |
| 정책
(Policy) | 조건 분기를 단순화하고, 더 자유롭게 만듦. |
| 일급 컬렉션
(First Class Collection) | 값 객체의 일종으로 컬렉션과 관련된 로직의 응집도를 높임. |
| 스프라우트 클래스
(Sprout Class) | 기존 로직을 변경하지 않고, 안전하게 새로운 기능을 추가함. |

**완전 생성자 :** 잘못된 상태로부터 클래스를 보호하기 위한 디자인 패턴

- 인스턴스 변수를 모두 초기화해야 한다.
- 생성자 내부에선 가드를 사용해서 잘못된 값이 들어오지 않게 한다.
- 인스턴스 변수에 final 수식자를 붙여서 불변으로 만들면, 생성 후에도 잘못된 상태로부터 방어할 수 있다.

**값 객체 :** 값을 클래스(자료형)로 나타내는 디자인 패턴

- 금액, 날짜, 주문 수, 전화번호 등 다양한 값을 객체로 만들어서 사용하면 각각의 값과 로직을 응집도가 높은 구조로 만들 수 있다.
- ex. 돈은 int로 하는 것보다 Money로 만들어서 사용!
- ‘값 객체 + 완전 생성자’는 객체 지향 설계에서 폭넓게 사용되는 기법

# **❓ Questions**

## **❓ 인스턴스 불변으로 선언했는데 변경하고 싶을 때, 변경된 값을 가진 새로운 인스턴스를 만들어서 사용하면 된다고 하는데 변경하면 새로운 인스턴스를 만들어서 메모리 차지가 많이 되지 않을까?**

불변 객체를 만드는 방법

1. 속성을 final로 선언
2. 변경 가능한 상태를 갖는 메서드 제공하지 않기: 불변 객체는 내부 상태를 변경하는 메서드를 제공하지 않는다. 대신에 변경된 새로운 객체를 반환하는 메서드를 제공

```java
class Money {
    final int amount;
    final Currency currency;

    Money(int amount, Currency currency) {
        this.amount = amount;
        this.currency = currency;
    }

    Money add(final int other) {
        int added = amount + other;
        return new Money(added, currency);
    }
}
```

위 코드의 Money 객체는 불변하다. 새로운 값을 추가할 때마다 새로운 Money 객체가 생성되지만, 기존 객체는 변경되지 않으므로 메모리 소비가 줄어든다.

## **❓ 수많이 생성되면 메모리 낭비 아닌가?**

GPT왈 : ㅇㅇ, 메모리 소비할 수 있다. 불변 객체는 객체가 생성된 후에 내부 상태를 변경할 수 없기 때문에 객체가 생성된 후에 메모리 상에 유지되는 것이 자연스럽다. 새로운 값을 추가하거나 수정할 때마다 새로운 객체를 생성해야하기 때문에 메모리 소비하는 것은 불가피하다.
